(function(y,U){typeof exports=="object"&&typeof module<"u"?U(exports):typeof define=="function"&&define.amd?define(["exports"],U):(y=typeof globalThis<"u"?globalThis:y||self,U(y.index={}))})(this,function(y){"use strict";const U=i=>(u,c,h)=>{const M=h.value;h.value=(...v)=>{const[p,b]=v,g=p.headers;if(g&&g.authorization===`Bearer ${i}`)return M.apply(void 0,v);b.status(401).json({error:"Not Authorized"})}};var H=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Q;(function(i){(function(u){var c=typeof H=="object"?H:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),h=M(i);typeof c.Reflect>"u"?c.Reflect=i:h=M(c.Reflect,h),u(h);function M(v,p){return function(b,g){typeof v[b]!="function"&&Object.defineProperty(v,b,{configurable:!0,writable:!0,value:g}),p&&p(b,g)}}})(function(u){var c=Object.prototype.hasOwnProperty,h=typeof Symbol=="function",M=h&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",v=h&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",p=typeof Object.create=="function",b={__proto__:[]}instanceof Array,g=!p&&!b,T={create:p?function(){return $(Object.create(null))}:b?function(){return $({__proto__:null})}:function(){return $({})},has:g?function(e,t){return c.call(e,t)}:function(e,t){return t in e},get:g?function(e,t){return c.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},j=Object.getPrototypeOf(Function),I=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",q=!I&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Be(),S=!I&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Le(),B=!I&&typeof WeakMap=="function"?WeakMap:Ve(),R=new B;function E(e,t,n,r){if(_(n)){if(!ae(e))throw new TypeError;if(!oe(t))throw new TypeError;return je(e,t)}else{if(!ae(e))throw new TypeError;if(!w(t))throw new TypeError;if(!w(r)&&!_(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),n=O(n),Ie(e,t,n,r)}}u("decorate",E);function A(e,t){function n(r,a){if(!w(r))throw new TypeError;if(!_(a)&&!Ue(a))throw new TypeError;ee(e,t,r,a)}return n}u("metadata",A);function L(e,t,n,r){if(!w(n))throw new TypeError;return _(r)||(r=O(r)),ee(e,t,n,r)}u("defineMetadata",L);function ke(e,t,n){if(!w(t))throw new TypeError;return _(n)||(n=O(n)),J(e,t,n)}u("hasMetadata",ke);function Re(e,t,n){if(!w(t))throw new TypeError;return _(n)||(n=O(n)),V(e,t,n)}u("hasOwnMetadata",Re);function Te(e,t,n){if(!w(t))throw new TypeError;return _(n)||(n=O(n)),X(e,t,n)}u("getMetadata",Te);function Oe(e,t,n){if(!w(t))throw new TypeError;return _(n)||(n=O(n)),K(e,t,n)}u("getOwnMetadata",Oe);function Ee(e,t){if(!w(e))throw new TypeError;return _(t)||(t=O(t)),te(e,t)}u("getMetadataKeys",Ee);function Ae(e,t){if(!w(e))throw new TypeError;return _(t)||(t=O(t)),ne(e,t)}u("getOwnMetadataKeys",Ae);function Pe(e,t,n){if(!w(t))throw new TypeError;_(n)||(n=O(n));var r=D(t,n,!1);if(_(r)||!r.delete(e))return!1;if(r.size>0)return!0;var a=R.get(t);return a.delete(n),a.size>0||R.delete(t),!0}u("deleteMetadata",Pe);function je(e,t){for(var n=e.length-1;n>=0;--n){var r=e[n],a=r(t);if(!_(a)&&!x(a)){if(!oe(a))throw new TypeError;t=a}}return t}function Ie(e,t,n,r){for(var a=e.length-1;a>=0;--a){var m=e[a],s=m(t,n,r);if(!_(s)&&!x(s)){if(!w(s))throw new TypeError;r=s}}return r}function D(e,t,n){var r=R.get(e);if(_(r)){if(!n)return;r=new q,R.set(e,r)}var a=r.get(t);if(_(a)){if(!n)return;a=new q,r.set(t,a)}return a}function J(e,t,n){var r=V(e,t,n);if(r)return!0;var a=N(t);return x(a)?!1:J(e,a,n)}function V(e,t,n){var r=D(t,n,!1);return _(r)?!1:xe(r.has(e))}function X(e,t,n){var r=V(e,t,n);if(r)return K(e,t,n);var a=N(t);if(!x(a))return X(e,a,n)}function K(e,t,n){var r=D(t,n,!1);if(!_(r))return r.get(e)}function ee(e,t,n,r){var a=D(n,r,!0);a.set(e,t)}function te(e,t){var n=ne(e,t),r=N(e);if(r===null)return n;var a=te(r,t);if(a.length<=0)return n;if(n.length<=0)return a;for(var m=new S,s=[],f=0,o=n;f<o.length;f++){var l=o[f],d=m.has(l);d||(m.add(l),s.push(l))}for(var P=0,ue=a;P<ue.length;P++){var l=ue[P],d=m.has(l);d||(m.add(l),s.push(l))}return s}function ne(e,t){var n=[],r=D(e,t,!1);if(_(r))return n;for(var a=r.keys(),m=De(a),s=0;;){var f=We(m);if(!f)return n.length=s,n;var o=Fe(f);try{n[s]=o}catch(l){try{ze(m)}finally{throw l}}s++}}function re(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function _(e){return e===void 0}function x(e){return e===null}function Se(e){return typeof e=="symbol"}function w(e){return typeof e=="object"?e!==null:typeof e=="function"}function Ce(e,t){switch(re(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var n=t===3?"string":t===5?"number":"default",r=ie(e,M);if(r!==void 0){var a=r.call(e,n);if(w(a))throw new TypeError;return a}return qe(e,n==="default"?"number":n)}function qe(e,t){if(t==="string"){var n=e.toString;if(G(n)){var r=n.call(e);if(!w(r))return r}var a=e.valueOf;if(G(a)){var r=a.call(e);if(!w(r))return r}}else{var a=e.valueOf;if(G(a)){var r=a.call(e);if(!w(r))return r}var m=e.toString;if(G(m)){var r=m.call(e);if(!w(r))return r}}throw new TypeError}function xe(e){return!!e}function Ge(e){return""+e}function O(e){var t=Ce(e,3);return Se(t)?t:Ge(t)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function G(e){return typeof e=="function"}function oe(e){return typeof e=="function"}function Ue(e){switch(re(e)){case 3:return!0;case 4:return!0;default:return!1}}function ie(e,t){var n=e[t];if(n!=null){if(!G(n))throw new TypeError;return n}}function De(e){var t=ie(e,v);if(!G(t))throw new TypeError;var n=t.call(e);if(!w(n))throw new TypeError;return n}function Fe(e){return e.value}function We(e){var t=e.next();return t.done?!1:t}function ze(e){var t=e.return;t&&t.call(e)}function N(e){var t=Object.getPrototypeOf(e);if(typeof e!="function"||e===j||t!==j)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(r==null||r===Object.prototype)return t;var a=r.constructor;return typeof a!="function"||a===e?t:a}function Be(){var e={},t=[],n=function(){function s(f,o,l){this._index=0,this._keys=f,this._values=o,this._selector=l}return s.prototype["@@iterator"]=function(){return this},s.prototype[v]=function(){return this},s.prototype.next=function(){var f=this._index;if(f>=0&&f<this._keys.length){var o=this._selector(this._keys[f],this._values[f]);return f+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:o,done:!1}}return{value:void 0,done:!0}},s.prototype.throw=function(f){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),f},s.prototype.return=function(f){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:f,done:!0}},s}();return function(){function s(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(s.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),s.prototype.has=function(f){return this._find(f,!1)>=0},s.prototype.get=function(f){var o=this._find(f,!1);return o>=0?this._values[o]:void 0},s.prototype.set=function(f,o){var l=this._find(f,!0);return this._values[l]=o,this},s.prototype.delete=function(f){var o=this._find(f,!1);if(o>=0){for(var l=this._keys.length,d=o+1;d<l;d++)this._keys[d-1]=this._keys[d],this._values[d-1]=this._values[d];return this._keys.length--,this._values.length--,f===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},s.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},s.prototype.keys=function(){return new n(this._keys,this._values,r)},s.prototype.values=function(){return new n(this._keys,this._values,a)},s.prototype.entries=function(){return new n(this._keys,this._values,m)},s.prototype["@@iterator"]=function(){return this.entries()},s.prototype[v]=function(){return this.entries()},s.prototype._find=function(f,o){return this._cacheKey!==f&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=f)),this._cacheIndex<0&&o&&(this._cacheIndex=this._keys.length,this._keys.push(f),this._values.push(void 0)),this._cacheIndex},s}();function r(s,f){return s}function a(s,f){return f}function m(s,f){return[s,f]}}function Le(){return function(){function e(){this._map=new q}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._map.has(t)},e.prototype.add=function(t){return this._map.set(t,t),this},e.prototype.delete=function(t){return this._map.delete(t)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[v]=function(){return this.keys()},e}()}function Ve(){var e=16,t=T.create(),n=r();return function(){function o(){this._key=r()}return o.prototype.has=function(l){var d=a(l,!1);return d!==void 0?T.has(d,this._key):!1},o.prototype.get=function(l){var d=a(l,!1);return d!==void 0?T.get(d,this._key):void 0},o.prototype.set=function(l,d){var P=a(l,!0);return P[this._key]=d,this},o.prototype.delete=function(l){var d=a(l,!1);return d!==void 0?delete d[this._key]:!1},o.prototype.clear=function(){this._key=r()},o}();function r(){var o;do o="@@WeakMap@@"+f();while(T.has(t,o));return t[o]=!0,o}function a(o,l){if(!c.call(o,n)){if(!l)return;Object.defineProperty(o,n,{value:T.create()})}return o[n]}function m(o,l){for(var d=0;d<l;++d)o[d]=Math.random()*255|0;return o}function s(o){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(o)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(o)):m(new Uint8Array(o),o):m(new Array(o),o)}function f(){var o=s(e);o[6]=o[6]&79|64,o[8]=o[8]&191|128;for(var l="",d=0;d<e;++d){var P=o[d];(d===4||d===6||d===8)&&(l+="-"),P<16&&(l+="0"),l+=P.toString(16).toLowerCase()}return l}}function $(e){return e.__=void 0,delete e.__,e}})})(Q||(Q={}));const se=(i="")=>u=>{Reflect.defineMetadata("prefix",i,u),Reflect.hasMetadata("routes",u)||Reflect.defineMetadata("routes",[],u)};var F=(i=>(i.and="and",i.or="or",i))(F||{});const fe=(i=[],u=F.and)=>c=>{Reflect.defineMetadata("use-role-class",{roles:i,operator:u},c)},ce=(i=[],u=F.and)=>c=>{Reflect.defineMetadata("use-role-method",{roles:i,operator:u},c.constructor)};var C=(i=>(i.get="get",i.post="post",i.put="put",i.delete="delete",i))(C||{}),k=(i=>(i.param="param",i.query="query",i.req="req",i.res="res",i.body="body",i))(k||{});const W=i=>u=>(c,h,M)=>{Reflect.hasMetadata("routes",c.constructor)||Reflect.defineMetadata("routes",[],c.constructor);const v=Reflect.getMetadata("routes",c.constructor);v.push({method:i,path:u,handlerName:h}),Reflect.defineMetadata("routes",v,c.constructor);const p=Reflect.getMetadata(k.req,c[h]),b=Reflect.getMetadata(k.res,c[h]),g=Reflect.getMetadata(k.param,c[h]),T=Reflect.getMetadata(k.query,c[h]),j=Reflect.getMetadata(k.body,c[h]),I=M.value;M.value=(...q)=>{const[S,B]=q,R=[...q];if(p&&(R[p.index]=S),b&&(R[b.index]=B),g){const{key:E,index:A}=g;R[A]=S.params[E]}if(T){const{key:E,zod:A,index:L}=T;R[L]=E?A.parse(S.query[E]):A.parse(S.query)}if(j){const{zod:E,index:A}=j;R[A]=E.parse(S.body)}return I.apply(void 0,R)}},le=W(C.get),de=W(C.post),he=W(C.put),ye=W(C.delete),z=i=>u=>(c,h,M)=>{const v=c[h],p={key:u==null?void 0:u.key,zod:u==null?void 0:u.zod,index:M};Reflect.defineMetadata(i,p,v)},Y=i=>(u,c,h)=>{const M=u[c];Reflect.defineMetadata(i,{index:h},M)},ve=z(k.param),pe=z(k.query),_e=Y(k.req),we=Y(k.res),Me=z(k.body),Z=({roles:i,operator:u},c)=>u===F.and?i.every(h=>c.includes(h)):c.some(h=>i.includes(h)),me=i=>(u,c,h)=>{const M=h.value;h.value=(...v)=>{const[,p]=v,b=Array.isArray(i)?i:[i],g=Reflect.getMetadata("use-role-class",u),T=Reflect.getMetadata("use-role-method",u.constructor),j=Z(g,b),I=Z(T,b);return j?I?M.apply(void 0,v):p.status(403).json({error:"Forbidden"}):p.status(403).json({error:"Forbidden"})}},be=require("express"),ge=i=>{const u=be.Router();return i.forEach(c=>{const h=new c,M=Reflect.getMetadata("prefix",c);Reflect.getMetadata("routes",c).forEach(p=>{u[p.method](`${M}${p.path}`,(b,g)=>{h[p.handlerName](b,g)})})}),u};y.AuthGuard=U,y.Body=Me,y.Controller=se,y.Delete=ye,y.Get=le,y.Method=C,y.Param=ve,y.Parameter=k,y.Post=de,y.Put=he,y.Query=pe,y.Req=_e,y.Res=we,y.RoleGuard=me,y.UseRoleClass=fe,y.UseRoleMethod=ce,y.getRouter=ge,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
